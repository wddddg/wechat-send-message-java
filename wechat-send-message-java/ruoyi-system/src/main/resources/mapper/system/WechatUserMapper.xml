<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.WechatUserMapper">

	<resultMap type="WechatUserVO" id="WechatUserResult">
		<result property="idNumber" column="id_number" />
		<result property="createTime" column="create_time" />
	</resultMap>

	<resultMap type="WechatUserRechargeVO" id="WechatUserRechargeResult">
		<result property="userId" column="user_id" />
		<result property="rechargeAmount" column="recharge_amount" />
		<result property="createTime" column="create_time" />
	</resultMap>

	<select id="queryList" resultMap="WechatUserResult">
		select u.*, b.balance as balance from user u left outer join user_balance b on u.id = b.user_id
		<where>
			<if test="name != null and name != ''">
				AND u.name like concat('%', #{name}, '%')
			</if>
			<if test="phone != null and phone != ''">
				AND u.phone like concat('%', #{phone}, '%')
			</if>
			<if test="sex != null">
				AND u.sex = #{sex}
			</if>
			<if test="params.beginCreateTime != null and params.beginCreateTime != ''"><!-- 开始时间检索 -->
				AND date_format(#{params.endCreateTime},'%y%m%d') &lt;= date_format(#{params.beginCreateTime},'%y%m%d')
			</if>
		</where>
		order by u.create_time desc
	</select>

	<select id="getWechatUserRechargeRecord" resultMap="WechatUserRechargeResult">
		select r.*, u.name as userName, u.phone as userPhone, u.avatar as userAvatar from user_recharge_record r left outer join user u on r.user_id = u.id
		<where>
			<if test="name != null and name != ''">
				AND u.name like concat('%', #{name}, '%')
			</if>
			<if test="phone != null and phone != ''">
				AND u.phone like concat('%', #{phone}, '%')
			</if>
			<if test="params.beginCreateTime != null and params.beginCreateTime != ''"><!-- 开始时间检索 -->
				AND date_format(r.create_time,'%y%m%d') &gt;= date_format(#{params.beginCreateTime},'%y%m%d')
			</if>
			<if test="params.endCreateTime != null and params.endCreateTime != ''"><!-- 结束时间检索 -->
				AND date_format(r.create_time,'%y%m%d') &lt;= date_format(#{params.endCreateTime},'%y%m%d')
			</if>
		</where>
		order by r.create_time desc
	</select>

</mapper> 